<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Report</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 16px;
      margin: 0;
      background: #f4f4f4;
    }

    h2 {
      text-align: center;
      color: #007bff;
    }

    .card {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    select {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .tabs {
      display: flex;
      margin-bottom: 16px;
    }

    .tab {
      flex: 1;
      padding: 10px;
      text-align: center;
      background: #ddd;
      border-radius: 10px 10px 0 0;
      cursor: pointer;
    }

    .tab.active {
      background: #007bff;
      color: white;
    }

    .content {
      border: 1px solid #ddd;
      border-radius: 0 0 10px 10px;
      padding: 12px;
      background: white;
    }

    .entry {
      margin-bottom: 8px;
      border-bottom: 1px solid #eee;
      padding-bottom: 6px;
    }

    .label {
      font-weight: bold;
      color: #333;
    }

    @media (max-width: 600px) {
      h2 { font-size: 20px; }
      .tab { font-size: 14px; padding: 8px; }
    }
  </style>
</head>
<body>
  <h2>Student Report</h2>

  <div class="card">
    <select id="studentSelect">
      <option value="">Select a student</option>
    </select>

    <div class="tabs">
      <div class="tab active" id="attendanceTab">Attendance</div>
      <div class="tab" id="paymentTab">Payment</div>
    </div>

    <div class="content" id="reportContent">
      <p>Select a student to view their report.</p>
    </div>
  </div>

  <script>
    const studentSelect = document.getElementById('studentSelect');
    const attendanceTab = document.getElementById('attendanceTab');
    const paymentTab = document.getElementById('paymentTab');
    const reportContent = document.getElementById('reportContent');

    const students = JSON.parse(localStorage.getItem('students')) || [];
    const attendance = JSON.parse(localStorage.getItem('attendance')) || {};
    const payments = JSON.parse(localStorage.getItem('payments')) || {};

    // Populate dropdown
    students.forEach(student => {
      const opt = document.createElement('option');
      opt.value = student.id;
      opt.textContent = student.name + " (" + student.phone + ")";
      studentSelect.appendChild(opt);
    });

    let currentTab = "attendance";

    attendanceTab.onclick = () => {
      currentTab = "attendance";
      attendanceTab.classList.add('active');
      paymentTab.classList.remove('active');
      showReport();
    };

    paymentTab.onclick = () => {
      currentTab = "payment";
      paymentTab.classList.remove('active');
      attendanceTab.classList.remove('active');
      paymentTab.classList.add('active');
      showReport();
    };

    studentSelect.onchange = () => {
      showReport();
    };

    function showReport() {
      const studentId = studentSelect.value;
      if (!studentId) {
        reportContent.innerHTML = `<p>Please select a student to see details.</p>`;
        return;
      }

      const student = students.find(s => s.id === studentId);
      if (!student) return;

      if (currentTab === "attendance") {
        const studentAttendance = attendance[studentId] || {};
        let content = `<h3>Attendance History</h3>`;
        const dates = Object.keys(studentAttendance).sort();

        if (dates.length === 0) {
          content += `<p>No attendance records found.</p>`;
        } else {
          dates.forEach(date => {
            content += `<div class="entry"><span class="label">${date}:</span> ${studentAttendance[date]}</div>`;
          });
        }

        reportContent.innerHTML = content;
      }

      if (currentTab === "payment") {
        const studentPayments = payments[studentId] || [];
        let totalPaid = 0;
        let content = `<h3>Payment History</h3>`;

        if (studentPayments.length === 0) {
          content += `<p>No payments found.</p>`;
        } else {
          studentPayments.forEach(entry => {
            totalPaid += parseFloat(entry.amount);
            content += `<div class="entry"><span class="label">${entry.date}:</span> Paid ₹${entry.amount}</div>`;
          });
        }

        const balance = student.totalFee ? (student.totalFee - totalPaid) : "N/A";

        content += `<hr/><div><span class="label">Total Fee:</span> ₹${student.totalFee || "Not Set"}</div>`;
        content += `<div><span class="label">Total Paid:</span> ₹${totalPaid}</div>`;
        content += `<div><span class="label">Pending Balance:</span> ₹${balance}</div>`;

        reportContent.innerHTML = content;
      }
    }
  </script>
</body>
</html>
