<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reports</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 16px;
      background-color: #f2f2f2;
    }

    h2 {
      color: #007bff;
      margin-bottom: 12px;
    }

    .summary-box {
      background-color: #fff;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      box-shadow: 0 0 8px rgba(0,0,0,0.05);
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .section-title {
      margin-top: 30px;
      color: #333;
      border-bottom: 2px solid #007bff;
      padding-bottom: 5px;
    }

    .card {
      background: #fff;
      margin-top: 10px;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    @media (max-width: 600px) {
      .summary-row {
        flex-direction: column;
        gap: 4px;
      }
    }
  </style>
</head>
<body>

  <h2>Financial Summary</h2>
  <div class="summary-box" id="financialSummary">
    <div class="summary-row">
      <span>Today's Profit:</span>
      <span id="todayProfit">₹0</span>
    </div>
    <div class="summary-row">
      <span>Weekly Profit:</span>
      <span id="weekProfit">₹0</span>
    </div>
    <div class="summary-row">
      <span>Monthly Profit:</span>
      <span id="monthProfit">₹0</span>
    </div>
    <div class="summary-row">
      <span>Total Profit:</span>
      <span id="totalProfit">₹0</span>
    </div>
  </div>

  <h2 class="section-title">Attendance Report</h2>
  <div id="attendanceReport"></div>

  <script>
    function loadFinancialSummary() {
      const students = JSON.parse(localStorage.getItem("students") || "[]");
      const payments = JSON.parse(localStorage.getItem("payments") || "[]");

      const today = new Date();
      const oneDay = 86400000;
      let todayTotal = 0, weekTotal = 0, monthTotal = 0, total = 0;

      // Helper to check date within X days
      function isWithinDays(dateStr, days) {
        const date = new Date(dateStr);
        return (today - date) <= (days * oneDay);
      }

      // Process initial payments from student records
      students.forEach(s => {
        const paid = parseFloat(s.initialPayment || 0);
        const joinedDate = s.joinedOn || s.date || "";
        if (!joinedDate) return;

        total += paid;
        if (isWithinDays(joinedDate, 30)) monthTotal += paid;
        if (isWithinDays(joinedDate, 7)) weekTotal += paid;
        if (isWithinDays(joinedDate, 1)) todayTotal += paid;
      });

      // Process fee payments
      payments.forEach(p => {
        const amt = parseFloat(p.amount || 0);
        if (!p.date) return;

        total += amt;
        if (isWithinDays(p.date, 30)) monthTotal += amt;
        if (isWithinDays(p.date, 7)) weekTotal += amt;
        if (isWithinDays(p.date, 1)) todayTotal += amt;
      });

      // Show in UI
      document.getElementById("todayProfit").textContent = `₹${todayTotal}`;
      document.getElementById("weekProfit").textContent = `₹${weekTotal}`;
      document.getElementById("monthProfit").textContent = `₹${monthTotal}`;
      document.getElementById("totalProfit").textContent = `₹${total}`;
    }

    function loadAttendanceReport() {
      const attendance = JSON.parse(localStorage.getItem("attendance") || "{}");
      const students = JSON.parse(localStorage.getItem("students") || "[]");
      const container = document.getElementById("attendanceReport");
      container.innerHTML = "";

      for (let date in attendance) {
        const list = attendance[date];
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<strong>${date}</strong><br>${list.join(", ")}`;
        container.appendChild(div);
      }
    }

    loadFinancialSummary();
    loadAttendanceReport();
  </script>

</body>
</html>
