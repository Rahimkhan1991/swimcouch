<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>View Students</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
      background: #f4f6f9;
      margin: 0;
    }

    h2 {
      color: #007bff;
      text-align: center;
    }

    .student-card {
      background: white;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .student-info {
      flex: 1;
      min-width: 200px;
    }

    .student-photo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 10px;
    }

    .actions {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .actions button {
      padding: 6px;
      font-size: 12px;
    }

    .pending-red {
      color: red;
      font-weight: bold;
    }

    #editModal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      z-index: 1000;
      display: none;
    }

    #editModal input {
      margin-bottom: 10px;
      padding: 6px;
      width: 100%;
    }

    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 999;
      display: none;
    }

    @media (max-width: 500px) {
      .student-card {
        flex-direction: column;
        align-items: flex-start;
      }

      .student-info {
        margin-top: 10px;
      }

      .actions {
        flex-direction: row;
        width: 100%;
        justify-content: flex-end;
      }
    }
  </style>
</head>
<body>
  <h2>View Students</h2>
  <div id="studentList"></div>

  <!-- Edit Modal -->
  <div id="overlay"></div>
  <div id="editModal">
    <h3>Edit Student</h3>
    <input type="hidden" id="editId">
    <input type="text" id="editName" placeholder="Name">
    <input type="text" id="editPhone" placeholder="Phone">
    <input type="number" id="editTotalFee" placeholder="Total Fee">
    <input type="number" id="editInitialPayment" placeholder="Initial Payment">
    <button onclick="saveEdit()">Save</button>
    <button onclick="closeEdit()">Cancel</button>
  </div>

  <script>
    const studentListEl = document.getElementById("studentList");
    const students = JSON.parse(localStorage.getItem("students") || "[]");
    const feeRecords = JSON.parse(localStorage.getItem("fees") || "[]");

    function renderStudents() {
      studentListEl.innerHTML = "";

      students.forEach((student, index) => {
        const feeForStudent = feeRecords
          .filter(f => f.name === student.name && f.phone === student.phone)
          .reduce((sum, f) => sum + parseFloat(f.amount), 0);

        const totalPaid = (parseFloat(student.initialPayment) || 0) + feeForStudent;
        const pending = (parseFloat(student.totalFee) || 0) - totalPaid;

        const card = document.createElement("div");
        card.className = "student-card";

        card.innerHTML = `
          <img src="${student.photo || ''}" alt="Photo" class="student-photo">
          <div class="student-info">
            <strong>${student.name}</strong><br>
            ðŸ“ž ${student.phone}<br>
            ðŸ’° Total Fee: ${student.totalFee} | Paid: ${totalPaid}<br>
            <span class="${pending > 0 ? 'pending-red' : ''}">Pending: ${pending}</span>
          </div>
          <div class="actions">
            <button onclick="editStudent(${index})">Edit</button>
            <button onclick="deleteStudent(${index})">Delete</button>
          </div>
        `;

        studentListEl.appendChild(card);
      });
    }

    function editStudent(index) {
      const s = students[index];
      document.getElementById("editId").value = index;
      document.getElementById("editName").value = s.name;
      document.getElementById("editPhone").value = s.phone;
      document.getElementById("editTotalFee").value = s.totalFee;
      document.getElementById("editInitialPayment").value = s.initialPayment;

      document.getElementById("overlay").style.display = "block";
      document.getElementById("editModal").style.display = "block";
    }

    function closeEdit() {
      document.getElementById("overlay").style.display = "none";
      document.getElementById("editModal").style.display = "none";
    }

    function saveEdit() {
      const id = document.getElementById("editId").value;
      students[id].name = document.getElementById("editName").value;
      students[id].phone = document.getElementById("editPhone").value;
      students[id].totalFee = document.getElementById("editTotalFee").value;
      students[id].initialPayment = document.getElementById("editInitialPayment").value;

      localStorage.setItem("students", JSON.stringify(students));
      closeEdit();
      renderStudents();
    }

    function deleteStudent(index) {
      if (confirm("Are you sure you want to delete this student?")) {
        students.splice(index, 1);
        localStorage.setItem("students", JSON.stringify(students));
        renderStudents();
      }
    }

    renderStudents();
  </script>
</body>
</html>
