<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>View Students</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      background: #f0f4f8;
    }
    h2 {
      text-align: center;
      color: #007bff;
    }
    .student-card {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .student-card img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
    }
    .student-details {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    .student-info {
      flex: 1;
    }
    .actions {
      display: flex;
      gap: 10px;
    }
    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .edit-btn {
      background-color: #ffc107;
      color: #fff;
    }
    .delete-btn {
      background-color: #dc3545;
      color: #fff;
    }
    @media (max-width: 600px) {
      .student-details {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <h2>View Students</h2>
  <div id="studentsContainer"></div>

  <script>
    function loadStudents() {
      const studentsContainer = document.getElementById('studentsContainer');
      studentsContainer.innerHTML = '';

      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const feeData = JSON.parse(localStorage.getItem('feeData') || '[]');

      students.forEach((student, index) => {
        // Calculate total paid
        const collected = feeData
          .filter(fee => fee.name === student.name)
          .reduce((sum, fee) => sum + parseFloat(fee.amount || 0), 0);

        const initialPayment = parseFloat(student.initialPayment || 0);
        const totalFee = parseFloat(student.totalFee || 0);
        const paid = initialPayment + collected;
        const pending = Math.max(0, totalFee - paid);

        const card = document.createElement('div');
        card.className = 'student-card';

        card.innerHTML = `
          <div class="student-details">
            <img src="${student.image || ''}" alt="Student Image" onerror="this.src='https://via.placeholder.com/100'"/>
            <div class="student-info">
              <strong>${student.name}</strong><br>
              Phone: ${student.phone}<br>
              Day: ${student.day}<br>
              Total Fee: ₹${totalFee}<br>
              Paid: ₹${paid}<br>
              <span style="color:${pending > 0 ? 'red' : 'green'}">Pending: ₹${pending}</span>
            </div>
          </div>
          <div class="actions">
            <button class="edit-btn" onclick="editStudent(${index})">Edit</button>
            <button class="delete-btn" onclick="deleteStudent(${index})">Delete</button>
          </div>
        `;

        studentsContainer.appendChild(card);
      });
    }

    function editStudent(index) {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const student = students[index];
      const name = prompt("Edit name:", student.name);
      if (!name) return;

      const phone = prompt("Edit phone:", student.phone);
      const day = prompt("Edit day:", student.day);
      const totalFee = prompt("Edit total fee:", student.totalFee);
      const initialPayment = prompt("Edit initial payment:", student.initialPayment);

      students[index] = {
        ...student,
        name,
        phone,
        day,
        totalFee,
        initialPayment
      };

      localStorage.setItem('students', JSON.stringify(students));
      loadStudents();
    }

    function deleteStudent(index) {
      if (!confirm('Are you sure you want to delete this student?')) return;
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      students.splice(index, 1);
      localStorage.setItem('students', JSON.stringify(students));
      loadStudents();
    }

    loadStudents();
  </script>
</body>
</html>
